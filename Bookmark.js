javascript: (() => {function getDistance(t,e,i,a){var s=deg2rad(i-t),n=deg2rad(a-e),l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(deg2rad(t))*Math.cos(deg2rad(i))*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}function deg2rad(t){return t*(Math.PI/180)}function computeSlopeDeviation(t,e,i,a,s,n){return t+.05*(1e3*getDistance(e,i,a,s))-n}function getRwHeading(){let t=runway.heading,e=geofs.animation.values.heading360;if(e>=t+90||e<=t-90){return(runway.heading+180)%360}return t}function getRwThreshold(){let t=runway.heading,e=geofs.animation.values.heading;if(e>=t+90||e<=t-90){let t=runway.location[1],e=runway.location[0],i=runway.lengthInLla[1];return[e+runway.lengthInLla[0],t+i,0]}return runway.location}function radians(t){return t*(Math.PI/180)}function degrees(t){return t*(180/Math.PI)}function getBearing(t,e,i,a){startLat=radians(i),startLong=radians(a),endLat=radians(t),endLong=radians(e);let s=endLong-startLong,n=Math.log(Math.tan(endLat/2+Math.PI/4)/Math.tan(startLat/2+Math.PI/4));return Math.abs(s)>Math.PI&&(s=s>0?-(2*Math.PI-s):2*Math.PI+s),(degrees(Math.atan2(s,n))+360)%360}function computeLocDeviation(t,e,i,a){return getRwHeading()-getBearing(t,e,i,a)}function getNearestRunway(){return Object.values(geofs.runways.nearRunways)[0]}let runway=getNearestRunway();function displayDeviations(){a=getRwThreshold(),b=geofs.aircraft.instance.llaLocation,locdev=clamp(20*-computeLocDeviation(a[0],a[1],b[0],b[1]),-250,250),gsdev=clamp(3*computeSlopeDeviation(Object.values(geofs.api.flatRunwayTerrainProviderInstance.regions)[0].referenceElevation,a[0],a[1],b[0],b[1],geofs.animation.values.altitudeMeters-4),-500,500)}let ilshead=0,locdev=0,gsdev=0,traffic=Object.values(multiplayer.visibleUsers);class ILSsim{constructor(t,e,i,a){this.Values={},this.Values.LocDev=0,this.Values.GSDev=0,this.Values.Heading=0,this.VisibilityToggleButton,this.Display={},this.Display.Element,this.Display.Context,this.Display.Width=t,this.Display.Height=e,this.Display.SizeWidth=i,this.Display.SizeHeight=a,this.Events=[]}AssignVisibilityToggleButton(t){this.VisibilityToggleButton=t;let e=this;this.VisibilityToggleButton.onclick=function(){"show"==this.innerText?(e.Display.Element.style.visibility="visible",this.innerText="hide"):(e.Display.Element.style.visibility="hidden",this.innerText="show")}}MakeLine(t,e,i,a,s){this.Display.Context.beginPath(),this.Display.Context.strokeStyle=t,this.Display.Context.moveTo(e,i),this.Display.Context.lineTo(a,s),this.Display.Context.stroke()}MakeText(t,e,i,a,s){this.Display.Context.beginPath();let n=this.Display.Context.fillStyle,l=this.Display.Context.font;this.Display.Context.beginPath(),this.Display.Context.fillStyle=e,s&&(this.Display.Context.font=s),this.Display.Context.fillText(t,i,a),this.Display.Context.fillStyle=n,this.Display.Context.font=l}MakeRect(t,e,i,a,s,n){this.Display.Context.beginPath(),this.Display.Context.strokeStyle=e,this.Display.Context.rect(i,a,s,n),this.Display.Context.stroke(),this.Display.Context.fillStyle=t,this.Display.Context.fill()}MakePolygon(t,e,i,a){let s;for(s of(a&&this.AddEventToCanvas(t,a),this.Display.Context.beginPath(),this.Display.Context.moveTo(t[0][0],t[0][1]),t=t.slice(1))){let t=s[0],e=s[1];this.Display.Context.lineTo(t,e)}this.Display.Context.fillStyle=e,this.Display.Context.fill(),this.Display.Context.strokeStyle=i,this.Display.Context.stroke()}MakeCircle(t,e,i,a,s,n,l,h){this.Display.Context.beginPath(),n?this.Display.Context.arc(i,a,n,l,h):this.Display.Context.arc(i,a,s,0,2*Math.PI),this.Display.Context.strokeStyle=e,this.Display.Context.stroke(),this.Display.Context.fillStyle=t,this.Display.Context.fill()}MakeRoundSlider(t,e,i,a,s,n,l,h,o,r,c,y){let p=3.6*this.Values[a];p-=90,this.MakeCircle(n,s,t,e,i),this.MakeCircle(h,l,t,e,.5*i),this.MakePolygon([[t+-1*Math.cos(A2R(p+90)),e+-1*Math.sin(A2R(p+90))],[t+1*Math.cos(A2R(p+90)),e+1*Math.sin(A2R(p+90))],[t+1*Math.cos(A2R(p+90))+Math.cos(A2R(p))*i,e+1*Math.sin(A2R(p+90))+Math.sin(A2R(p))*i],[t+-1*Math.cos(A2R(p+90))+Math.cos(A2R(p))*i,e+-1*Math.sin(A2R(p+90))+Math.sin(A2R(p))*i]],r,o,function(t){t.path[0].onmouseup=function(t){y(t),t.path[0].onmousemove=void 0},t.path[0].onmousemove=function(t){c(t)}})}AddEventToCanvas(t,e){let i={points:t,func:e};this.Events[this.Events.length]=i}RemoveEventFromCanvas(t){let e=this.Events.indexOf(t);e>-1&&this.Events.splice(e,1)}ResetEvents(){this.Events.length=0}SetupEventHandler(){let t=this;this.Display.Element.onmousedown=function(e){let i,a=e.target.getBoundingClientRect(),s=t.Display.Width/t.Display.SizeWidth.slice(0,t.Display.SizeWidth.length-2),n=t.Display.Height/t.Display.SizeHeight.slice(0,t.Display.SizeHeight.length-2),l=e.clientX-a.left,h=e.clientY-a.top;for(i of(l*=s,h*=n,console.log("X: "+l+"\nY: "+h),console.log(e),t.Events)){let a=i.func,s=i.points;inside([l,h],s)&&(a(e),t.ResetEvents())}t.rDraw()}}SetupCanvas(){this.Display.Element=document.createElement("canvas"),this.Display.Element.width=this.Display.Width,this.Display.Element.height=this.Display.Height,this.Display.Element.style.width=this.Display.SizeWidth,this.Display.Element.style.height=this.Display.SizeHeight,this.Display.Element.style.position="absolute",this.Display.Element.style.left="25%",this.Display.Element.style.top="25%",this.Display.Element.style.transform="translate(-50%, -50%)",this.Display.Element.style.imageRendering="pixelated",document.body.appendChild(this.Display.Element),this.Display.Context=this.Display.Element.getContext("2d"),this.Display.Context.lineWidth=10}rDraw(){let t=this.Display.Width,e=this.Display.Height;this.Display.Context.clearRect(0,0,t,e),this.Draw()}Draw(){function t(){let t=ilshead,e=(Math.PI,locdev),n=100*Math.sin(Math.PI*(i/180)),l=100*Math.cos(Math.PI*(i/180)),h=Math.PI*(t+90)/180,o=[a-a/1.9,s-s/2];return[o[0]+e*Math.sin(h),o[1]-e*Math.cos(h),o[0]+n+e*Math.sin(h),o[1]-l-e*Math.cos(h)]}function e(t,e){let i=Math.PI*(t/180),n=[a-a/1.9,s-s/2];return[n[0]+e*Math.sin(i),n[1]+e*Math.cos(i)]}let i=ilshead,a=this.Display.Width,s=this.Display.Height;this.MakeRect("black","black",0,0,a,s),this.MakeCircle("white","white",a-a/1.9,s-s/2,300),this.MakeCircle("black","white",a-a/1.9,s-s/2,295),this.MakeLine("#e600ff",a-a/1.9,s-s/2,a-a/1.9+300*Math.sin(Math.PI*(i/180)),s-s/2-300*Math.cos(Math.PI*(i/180))),this.MakeLine("#e600ff",a-a/1.9,s-s/2,a-a/1.9-300*Math.sin(Math.PI*(i/180)),s-s/2+300*Math.cos(Math.PI*(i/180))),this.MakeCircle("black","black",a-a/1.9,s-s/2,100),traffic.forEach(function(t){display.MakeCircle("black","blue",e(getBearing(t.referencePoint.lla[0],t.referencePoint.lla[1],geofs.aircraft.instance.llaLocation[0],geofs.aircraft.instance.llaLocation[1]),t.distance/100)[0],e(getBearing(t.referencePoint.lla[0],t.referencePoint.lla[1],geofs.aircraft.instance.llaLocation[0],geofs.aircraft.instance.llaLocation[1]),t.distance/100)[1],5)}),this.MakeLine("yellow",a-a/1.9,s-s/2+20,a-a/1.9+60,s-s/2+20),this.MakeLine("yellow",a-a/1.9,s-s/2+20,a-a/1.9-60,s-s/2+20),this.MakeLine("yellow",a-a/1.9,s-s/2,a-a/1.9,s-s/2+100),this.MakeLine("yellow",a-a/1.9,s-s/2,a-a/1.9,s-s/2-20),this.MakeLine("yellow",a-a/1.9,s-s/2+75,a-a/1.9+25,s-s/2+75),this.MakeLine("yellow",a-a/1.9,s-s/2+75,a-a/1.9-25,s-s/2+75),this.MakeCircle("black","#e600ff",a-a/15,s-s/2+7-gsdev,20),this.MakeRect("yellow","yellow",a-a/10,s-s/2,a/15,s/100),this.MakeCircle("white","white",a-a/15,s-s/1.5,15),this.MakeCircle("black","white",a-a/15,s-s/1.5,8),this.MakeCircle("white","white",a-a/15,s-s/1.2,15),this.MakeCircle("black","white",a-a/15,s-s/1.2,8),this.MakeCircle("white","white",a-a/15,s-s/3.25,15),this.MakeCircle("black","white",a-a/15,s-s/3.25,8),this.MakeCircle("white","white",a-a/15,s-s/6.5,15),this.MakeCircle("black","white",a-a/15,s-s/6.5,8),this.MakeCircle("black","white",a-a/1.9-75*Math.cos(Math.PI*(i/180)),s-s/2-75*Math.sin(Math.PI*(i/180)),8),this.MakeCircle("black","white",a-a/1.9-200*Math.cos(Math.PI*(i/180)),s-s/2-200*Math.sin(Math.PI*(i/180)),8),this.MakeCircle("black","white",a-a/1.9+75*Math.cos(Math.PI*(i/180)),s-s/2+75*Math.sin(Math.PI*(i/180)),8),this.MakeCircle("black","white",a-a/1.9+200*Math.cos(Math.PI*(i/180)),s-s/2+200*Math.sin(Math.PI*(i/180)),8),this.MakeLine("#e600ff",t()[0],t()[1],t()[2],t()[3])}}let display=new ILSsim(1e3,1e3,"250px","250px");display.SetupCanvas(),display.SetupEventHandler(),display.Draw(),ilsInterval=setInterval(function(){traffic=Object.values(multiplayer.visibleUsers),runway=getNearestRunway(),ilshead=getRwHeading()-geofs.animation.values.heading360,displayDeviations(),display.rDraw()},200);})();
